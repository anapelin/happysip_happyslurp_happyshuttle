title.position = c('left', 'top'))
kde_n_second
#Central area of SG
central_area <- base_map %>% filter(PLN_AREA_N %in% c('DOWNTOWN CORE', 'SINGAPORE RIVER', 'MUSEUM','ORCHARD','NEWTON','ROCHOR', 'KALLANG','OUTRAM')) %>% filter(!SUBZONE_N %in% c( 'CITY TERMINALS','MARITIME SQUARE','ALEXANDRA HILL','TELOK BLANGAH DRIVE','DEPOT ROAD','TELOK BLANGAH WAY','TELOK BLANGAH RISE'))
central_area <- st_make_valid(central_area)
kde_n_second <- tm_shape(central_area) + tm_polygons() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.01, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
#Central area of SG
central_area <- base_map %>% filter(PLN_AREA_N %in% c('DOWNTOWN CORE', 'SINGAPORE RIVER', 'MUSEUM','ORCHARD','ROCHOR', 'KALLANG','OUTRAM')) %>% filter(!SUBZONE_N %in% c( 'CITY TERMINALS','MARITIME SQUARE','ALEXANDRA HILL','TELOK BLANGAH DRIVE','DEPOT ROAD','TELOK BLANGAH WAY','TELOK BLANGAH RISE'))
central_area <- st_make_valid(central_area)
kde_n_second <- tm_shape(central_area) + tm_polygons() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.01, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
#Central area of SG
central_area <- base_map %>% filter(PLN_AREA_N %in% c('DOWNTOWN CORE', 'SINGAPORE RIVER', 'MUSEUM','ROCHOR', 'KALLANG','OUTRAM')) %>% filter(!SUBZONE_N %in% c( 'CITY TERMINALS','MARITIME SQUARE','ALEXANDRA HILL','TELOK BLANGAH DRIVE','DEPOT ROAD','TELOK BLANGAH WAY','TELOK BLANGAH RISE'))
central_area <- st_make_valid(central_area)
kde_n_second <- tm_shape(central_area) + tm_polygons() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.01, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
#Central area of SG
central_area <- base_map %>% filter(PLN_AREA_N %in% c('DOWNTOWN CORE', 'SINGAPORE RIVER', 'MUSEUM','ROCHOR', 'KALLANG','OUTRAM')) %>% filter(!SUBZONE_N %in% c( 'TANJONG RHU'))
central_area <- st_make_valid(central_area)
kde_n_second <- tm_shape(central_area) + tm_polygons() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.01, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
kde_n_first <- tm_shape(r_nightlife_centers.m) +
tm_raster(n=10, stretch.palette = FALSE,title="KDE Values") +
tm_shape(base_map) + tm_borders() + tm_fill(alpha = 0) +
tm_shape(nightlife) + tm_dots(size=0.005) +
tm_legend(legend.outside=TRUE) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="KDE of nightlife locations",
title.position = c('left', 'top'))
kde_n_first
kde_n_second
#Central area of SG
central_area <- base_map %>% filter(PLN_AREA_N %in% c('DOWNTOWN CORE', 'SINGAPORE RIVER', 'MUSEUM','ROCHOR', 'KALLANG','OUTRAM')) %>% filter(!SUBZONE_N %in% c('TANJONG RHU', 'BENDEMEER','KALLANG BAHRU','KAMPONG BUGIS','BOONKENG','GEYLANG BAHRU'))
central_area <- st_make_valid(central_area)
kde_n_second <- tm_shape(central_area) + tm_polygons() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.01, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
tmap_mode('PLOT')
tmap_mode('plot')
#Central area of SG
central_area <- base_map %>% filter(PLN_AREA_N %in% c('DOWNTOWN CORE', 'SINGAPORE RIVER', 'MUSEUM','ROCHOR', 'KALLANG','OUTRAM')) %>% filter(!SUBZONE_N %in% c('TANJONG RHU', 'BENDEMEER','KALLANG BAHRU','KAMPONG BUGIS','BOON KENG','GEYLANG BAHRU'))
central_area <- st_make_valid(central_area)
kde_n_second <- tm_shape(central_area) + tm_polygons() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.01, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
kde_n_second <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.01, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
kde_n_second <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.05, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
kde_n_second <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.05, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
kde_n_second <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.5, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
kde_n_second <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.1, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
kde_n_second <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.25, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
kde_n_second <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.2, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
kde_n_second <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.15, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
kde_n_second <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.2, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
#reclassification for polygons
reclass_values_2 <- c(0,max(nightlife_centers$kde) / 6,1, #reclassify kde values from 0-1000 in group 1 and so on
max(nightlife_centers$kde) / 6,2 * max(nightlife_centers$kde) / 6,2,
2* max(nightlife_centers$kde) / 6,3 * max(nightlife_centers$kde) / 6,3,
3* max(nightlife_centers$kde) / 6,4 * max(nightlife_centers$kde) / 6,4,
4* max(nightlife_centers$kde) / 6,5 * max(nightlife_centers$kde) / 6,5,
5* max(nightlife_centers$kde) / 6,6 * max(nightlife_centers$kde) / 6,6,)
#reclassification for polygons
reclass_values_2 <- c(0,max(nightlife_centers$kde) / 6,1, #reclassify kde values from 0-1000 in group 1 and so on
max(nightlife_centers$kde) / 6,2 * max(nightlife_centers$kde) / 6,2,
2* max(nightlife_centers$kde) / 6,3 * max(nightlife_centers$kde) / 6,3,
3* max(nightlife_centers$kde) / 6,4 * max(nightlife_centers$kde) / 6,4,
4* max(nightlife_centers$kde) / 6,5 * max(nightlife_centers$kde) / 6,5,
5* max(nightlife_centers$kde) / 6,6 * max(nightlife_centers$kde) / 6,6)
reclass_nightlife_centers <- reclassify(as(nightlife_centers, "RasterLayer"), reclass_values_2) #reclassify kde values to groups
nightlife_centers_poly <- rasterToPolygons(reclass_nightlife_centers, dissolve = T, digits = 6) #to make a polygon layer
nightlife_centers_poly <- rasterToPolygons(reclass_nightlife_centers, dissolve = T, digits = 6) #to make a polygon layer
nightlife_centers_poly <- st_as_sf(nightlife_centers_poly) #to make an SF object
nightlife_centers_poly <- nightlife_centers_poly[-c(1,2),] #remove polys with low kde values
nightlife_centers_poly <- st_cast(nightlife_centers_poly,'POLYGON') #to split multipolygon to polygon to obtain centers
nightlife_centers_poly$kde <- factor(nightlife_centers_points$kde)
nightlife_centers_poly$kde #<- factor(nightlife_centers_points$kde)
kde_n_second <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.2, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
nightlife_centers_points <- st_centroid(nightlife_centers_poly)
#find closest busstop to each centroid
nightlife_centers_points <- st_transform(nightlife_centers_points, crs = 4326)
closest_nightlife_busstops_index <- st_nearest_feature(nightlife_centers_points, bus_spatial)
closest_nightlife_busstops <- bus_spatial[closest_nightlife_busstops_index,]
View(closest_nightlife_busstops)
nightlife_centers <- kde.points(nightlife_points, h = 0.0045) #750mm smoothing
nightlife_centers_sf <- st_as_sf(nightlife_centers)
r_nightlife_centers       <- raster(nightlife_centers)
r_nightlife_centers.m     <- mask(r_nightlife_centers, base_spatial)
kde_n_first <- tm_shape(r_nightlife_centers.m) +
tm_raster(n=10, stretch.palette = FALSE,title="KDE Values") +
tm_shape(base_map) + tm_borders() + tm_fill(alpha = 0) +
tm_shape(nightlife) + tm_dots(size=0.005) +
tm_legend(legend.outside=TRUE) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="KDE of nightlife locations",
title.position = c('left', 'top'))
kde_n_first
#reclassification for polygons
reclass_values_2 <- c(0,max(nightlife_centers$kde) / 6,1, #reclassify kde values from 0-1000 in group 1 and so on
max(nightlife_centers$kde) / 6,2 * max(nightlife_centers$kde) / 6,2,
2* max(nightlife_centers$kde) / 6,3 * max(nightlife_centers$kde) / 6,3,
3* max(nightlife_centers$kde) / 6,4 * max(nightlife_centers$kde) / 6,4,
4* max(nightlife_centers$kde) / 6,5 * max(nightlife_centers$kde) / 6,5,
5* max(nightlife_centers$kde) / 6,6 * max(nightlife_centers$kde) / 6,6)
reclass_nightlife_centers <- reclassify(as(nightlife_centers, "RasterLayer"), reclass_values_2) #reclassify kde values to groups
nightlife_centers_poly <- rasterToPolygons(reclass_nightlife_centers, dissolve = T, digits = 6) #to make a polygon layer
nightlife_centers_poly <- st_as_sf(nightlife_centers_poly) #to make an SF object
nightlife_centers_poly <- nightlife_centers_poly[-c(1,2),] #remove polys with low kde values
nightlife_centers_poly <- st_cast(nightlife_centers_poly,'POLYGON') #to split multipolygon to polygon to obtain centers
#get the centroids of each polygon
nightlife_centers_points <- st_centroid(nightlife_centers_poly)
#find closest busstop to each centroid
nightlife_centers_points <- st_transform(nightlife_centers_points, crs = 4326)
closest_nightlife_busstops_index <- st_nearest_feature(nightlife_centers_points, bus_spatial)
closest_nightlife_busstops <- bus_spatial[closest_nightlife_busstops_index,]
View(closest_busstops)
View(closest_nightlife_busstops)
nightlife_centers_poly$kde <- factor(nightlife_centers_points$kde)
#Onto finding ideal busstops for nightlife
#Central area of SG
central_area <- base_map %>% filter(PLN_AREA_N %in% c('DOWNTOWN CORE', 'SINGAPORE RIVER', 'MUSEUM','ROCHOR', 'KALLANG','OUTRAM')) %>% filter(!SUBZONE_N %in% c('TANJONG RHU', 'BENDEMEER','KALLANG BAHRU','KAMPONG BUGIS','BOON KENG','GEYLANG BAHRU'))
central_area <- st_make_valid(central_area)
nightlife_points <- as(nightlife, "Spatial")
nightlife_centers <- kde.points(nightlife_points, h = 0.00675) #750mm smoothing
nightlife_centers_sf <- st_as_sf(nightlife_centers)
r_nightlife_centers       <- raster(nightlife_centers)
r_nightlife_centers.m     <- mask(r_nightlife_centers, base_spatial)
kde_n_first <- tm_shape(r_nightlife_centers.m) +
tm_raster(n=10, stretch.palette = FALSE,title="KDE Values") +
tm_shape(base_map) + tm_borders() + tm_fill(alpha = 0) +
tm_shape(nightlife) + tm_dots(size=0.005) +
tm_legend(legend.outside=TRUE) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="KDE of nightlife locations",
title.position = c('left', 'top'))
kde_n_first
tmap_save(kde_first, filename = "plots/optimal_stops/kde_n_first.png")
#reclassification for polygons
reclass_values_2 <- c(0,max(nightlife_centers$kde) / 6,1, #reclassify kde values from 0-1000 in group 1 and so on
max(nightlife_centers$kde) / 6,2 * max(nightlife_centers$kde) / 6,2,
2* max(nightlife_centers$kde) / 6,3 * max(nightlife_centers$kde) / 6,3,
3* max(nightlife_centers$kde) / 6,4 * max(nightlife_centers$kde) / 6,4,
4* max(nightlife_centers$kde) / 6,5 * max(nightlife_centers$kde) / 6,5,
5* max(nightlife_centers$kde) / 6,6 * max(nightlife_centers$kde) / 6,6)
#6* max(nightlife_centers$kde) / 7, max(nightlife_centers$kde),7)
reclass_nightlife_centers <- reclassify(as(nightlife_centers, "RasterLayer"), reclass_values_2) #reclassify kde values to groups
nightlife_centers_poly <- rasterToPolygons(reclass_nightlife_centers, dissolve = T, digits = 6) #to make a polygon layer
nightlife_centers_poly <- st_as_sf(nightlife_centers_poly) #to make an SF object
nightlife_centers_poly <- nightlife_centers_poly[-c(1,2),] #remove polys with low kde values
nightlife_centers_poly <- st_cast(nightlife_centers_poly,'POLYGON') #to split multipolygon to polygon to obtain centers
nightlife_centers_poly$kde <- factor(nightlife_centers_points$kde)
nightlife_centers_poly$kde <- factor(nightlife_centers_points$kde)
nightlife_centers_poly$kde <- factor(nightlife_centers_polys$kde)
nightlife_centers_poly$kde <- factor(nightlife_centers_poly$kde)
kde_n_second <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(nightlife) + tm_dots(size = 0.2, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Filtered KDEs with nightlifes",
title.position = c('left', 'top'))
kde_n_second
tmap_save(kde_second, filename = "plots/optimal_stops/kde_second.png")
View(nightlife_points)
nightlife_centers_points <- st_centroid(nightlife_centers_poly)
#find closest busstop to each centroid
nightlife_centers_points <- st_transform(nightlife_centers_points, crs = 4326)
closest_nightlife_busstops_index <- st_nearest_feature(nightlife_centers_points, bus_spatial)
closest_nightlife_busstops <- bus_spatial[closest_nightlife_busstops_index,]
nightlife_final <- tm_shape(base_map) + tm_borders() +
tm_shape(hdb_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(closest_busstops) + tm_bubbles(size = 0.25, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Final Bus Stops",
title.size = 1,
title.position = c('left', 'top'))
nightlife_final
nightlife_final <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(closest__nightlife_busstops) + tm_bubbles(size = 0.25, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Final Bus Stops",
title.size = 1,
title.position = c('left', 'top'))
#get the centroids of each polygon
nightlife_centers_points <- st_centroid(nightlife_centers_poly)
#find closest busstop to each centroid
nightlife_centers_points <- st_transform(nightlife_centers_points, crs = 4326)
closest_nightlife_busstops_index <- st_nearest_feature(nightlife_centers_points, bus_spatial)
closest_nightlife_busstops <- bus_spatial[closest_nightlife_busstops_index,]
nightlife_final <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(closest__nightlife_busstops) + tm_bubbles(size = 0.25, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Final Bus Stops",
title.size = 1,
title.position = c('left', 'top'))
nightlife_final <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(closest_nightlife_busstops) + tm_bubbles(size = 0.25, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Final Bus Stops",
title.size = 1,
title.position = c('left', 'top'))
nightlife_final
tmap_save(nightlife_final, filename = "plots/optimal_stops/nightlife_final.png")
#bustops closest to each centroid
nightlife_final <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(closest_nightlife_busstops) + tm_bubbles(size = 0.25, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Final Bus Stops (Nightlife)",
title.size = 1,
title.position = c('left', 'top'))
nightlife_final
#bustops closest to each centroid
nightlife_final <- tm_shape(central_area) + tm_borders() +
tm_shape(nightlife_centers_poly) + tm_polygons(col = 'kde', title = 'KDE Group', palette = 'YlOrRd') +
tm_shape(closest_nightlife_busstops) + tm_bubbles(size = 0.25, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "top"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Final Bus Stops \n(Nightlife)",
title.size = 1,
title.position = c('left', 'top'))
nightlife_final
tmap_save(nightlife_final, filename = "plots/optimal_stops/nightlife_final.png")
combined_base_map_nightlife <- central_area %>%
group_by(REGION_N) %>%
summarise(geometry = st_combine(geometry))
combined_base_map_nightlife <- st_transform(combined_base_map_nightlife, crs = 4326)
combined_base_map_nightlife <- st_make_valid(combined_base_map_nightlife)
final_closest_busstops_nightlife <- st_intersection(closest_nightlife_busstops,combined_base_map_nightlife) #get the regions for each busstop
final_closest_busstops_nightlife <- distinct(final_closest_busstops_nightlife) #remove duplicated rows
final_closest_busstops_nightlife <- final_closest_busstops_nightlife %>% rename(Region = REGION_N)
View(final_closest_busstops_nightlife)
nightlife <- st_transform(nightlife, crs = 4326)
num_nightlife_captured <- nrow(st_intersection(nightlife, closest_nightlife_busstops_buffer))
closest_nightlife_busstops_buffer <- st_buffer(final_closest_nightlife_busstops, dist = 500) #500m buffer
#Evaluation
#creating buffer
closest_nightlife_busstops_buffer <- st_buffer(final_closest_busstops_nightlife, dist = 500) #500m buffer
closest_nightlife_busstops_buffer <- st_union(closest_nightlife_busstops_buffer) #join the buffers together
closest_nightlife_busstops_buffer <- st_cast(closest_nightlife_busstops_buffer,'POLYGON') #join the buffers together
closest_nightlife_busstops_buffer <- st_make_valid(closest_nightlife_busstops_buffer)
nightlife <- st_transform(nightlife, crs = 4326)
num_nightlife_captured <- nrow(st_intersection(nightlife, closest_nightlife_busstops_buffer))
percentage_captured <- num_nightlife_captured / nrow(nightlife)
print(percentage_captured)
nightlife <- st_read('dataset/processed_datasets/nightlife_locations.geojson', crs = st_crs(subzones))
nightlife <- st_transform(nightlife, crs = st_crs(4326))
num_nightlife_captured <- nrow(st_intersection(nightlife, closest_nightlife_busstops_buffer))
percentage_captured <- num_nightlife_captured / nrow(nightlife)
print(percentage_captured)
#500m radius: 71.0% nightlife captured
eval_nightlife <-tm_shape(central_area) + tm_borders() +
tm_shape(closest_nightlife_busstops_buffer) + tm_polygons(col = 'yellow') +
tm_shape(hdb_yth_pts) + tm_bubbles(size = 0.05, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "bottom"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Bus Stop Buffers \nwith Filtered HDBs",
title.size = 1,
title.position = c('left', 'top'))
eval_nightlife
eval_nightlife <-tm_shape(central_area) + tm_borders() +
tm_shape(closest_nightlife_busstops_buffer) + tm_polygons(col = 'yellow') +
tm_shape(nightlife) + tm_bubbles(size = 0.05, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "bottom"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Bus Stop Buffers \nwith Filtered HDBs",
title.size = 1,
title.position = c('left', 'top'))
eval_nightlife
eval_nightlife <-tm_shape(central_area) + tm_borders() +
tm_shape(closest_nightlife_busstops_buffer) + tm_polygons(col = 'yellow') +
tm_shape(nightlife) + tm_bubbles(size = 0.5, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "bottom"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Bus Stop Buffers \nwith Filtered HDBs",
title.size = 1,
title.position = c('left', 'top'))
eval_nightlife <-tm_shape(central_area) + tm_borders() +
tm_shape(closest_nightlife_busstops_buffer) + tm_polygons(col = 'yellow') +
tm_shape(nightlife) + tm_bubbles(size = 0.5, scale = 0.5, col = 'black')  +
tm_compass(type="8star", size = 2) +
tm_scale_bar(width = 0.15) +
tm_layout(legend.format = list(digits = 0),
legend.position = c("left", "bottom"),
legend.text.size = 0.5,
legend.title.size = 1,
title="Bus Stop Buffers \nwith Nightlife",
title.size = 1,
title.position = c('left', 'top'))
eval_nightlife
tmap_save(eval_nightlfie, filename = "plots/optimal_stops/eval_nightlife.png")
eval_nightlife
tmap_save(eval_nightlife, filename = "plots/optimal_stops/eval_nightlife.png")
